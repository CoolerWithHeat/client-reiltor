<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>UzKvartir - Stats</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="/img/icon-deal.png" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Inter:wght@700;800&display=swap"
        rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/custom_main.css" rel="stylesheet">
    <link href="/css/counter.css" rel="stylesheet">
</head>

<body>
    <div class="container-fluid bg-white mb-0 wow fadeIn" data-wow-delay="0.1s">
        <div style="margin-top: 5px;">
            <nav class="navbar navbar-expand-lg bg-white py-0 px-0">
                <div id="BrandSpace">
                    <div id="brandDiv1">
                        <a href="">                    
                            <img class="img-fluid" src="/img/icon-deal.png" alt="Icon" style="width: 25px; height: 25px;">
                        </a>
                    </div>
                    <div id="brandDiv2">
                        <a href="../../">
                            <h2 class="text-primary" id="BrandName">Kvartir.uz</h2>
                        </a>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    <div id="StatHolder">

        <div class="childStat">
            <div class="container">
                <div class="row">
                    <div class="col-md-3 col-sm-6">
                        <div class="counter">
                            <div class="counter-icon">
                                <i class="fa fa-globe"></i>
                            </div>
                            <h3>Ко Клиенты</h3>
                            <span id="TotalValueHolder" class="counter-value">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="childStat">
            <div class="container">
                <div class="row">
                    <div class="col-md-3 col-sm-6">
                        <div class="counter blue">
                            <div class="counter-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-apple" viewBox="0 0 16 16">
                                    <path d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516s1.52.087 2.475-1.258.762-2.391.728-2.43m3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422s1.675-2.789 1.698-2.854-.597-.79-1.254-1.157a3.7 3.7 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56s.625 1.924 1.273 2.796c.576.984 1.34 1.667 1.659 1.899s1.219.386 1.843.067c.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758q.52-1.185.473-1.282"/>
                                    <path d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516s1.52.087 2.475-1.258.762-2.391.728-2.43m3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422s1.675-2.789 1.698-2.854-.597-.79-1.254-1.157a3.7 3.7 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56s.625 1.924 1.273 2.796c.576.984 1.34 1.667 1.659 1.899s1.219.386 1.843.067c.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758q.52-1.185.473-1.282"/>
                                  </svg>
                                
                            </div>
                            <h3>IOS</h3>
                            <span id="IOSValueHolder" class="counter-value">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="childStat">
            <div class="container">
                <div class="row">
                    <div class="col-md-3 col-sm-6">
                        <div class="counter green">
                            <div class="counter-icon">
                                <img style="width: 30px; height: 30px;" src="/img/monitor.png" alt="">
                            </div>
                            <h3>Компьютер</h3>
                            <span id="DesktopValueHolder" class="counter-value">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="childStat">
            <div class="container">
                <div class="row">
                    <div class="col-md-3 col-sm-6">
                        <div class="counter green">
                            <div class="counter-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-android2" viewBox="0 0 16 16">
                                    <path d="m10.213 1.471.691-1.26q.069-.124-.048-.192-.128-.057-.195.058l-.7 1.27A4.8 4.8 0 0 0 8.005.941q-1.032 0-1.956.404l-.7-1.27Q5.281-.037 5.154.02q-.117.069-.049.193l.691 1.259a4.25 4.25 0 0 0-1.673 1.476A3.7 3.7 0 0 0 3.5 5.02h9q0-1.125-.623-2.072a4.27 4.27 0 0 0-1.664-1.476ZM6.22 3.303a.37.37 0 0 1-.267.11.35.35 0 0 1-.263-.11.37.37 0 0 1-.107-.264.37.37 0 0 1 .107-.265.35.35 0 0 1 .263-.11q.155 0 .267.11a.36.36 0 0 1 .112.265.36.36 0 0 1-.112.264m4.101 0a.35.35 0 0 1-.262.11.37.37 0 0 1-.268-.11.36.36 0 0 1-.112-.264q0-.154.112-.265a.37.37 0 0 1 .268-.11q.155 0 .262.11a.37.37 0 0 1 .107.265q0 .153-.107.264M3.5 11.77q0 .441.311.75.311.306.76.307h.758l.01 2.182q0 .414.292.703a.96.96 0 0 0 .7.288.97.97 0 0 0 .71-.288.95.95 0 0 0 .292-.703v-2.182h1.343v2.182q0 .414.292.703a.97.97 0 0 0 .71.288.97.97 0 0 0 .71-.288.95.95 0 0 0 .292-.703v-2.182h.76q.436 0 .749-.308.31-.307.311-.75V5.365h-9zm10.495-6.587a.98.98 0 0 0-.702.278.9.9 0 0 0-.293.685v4.063q0 .406.293.69a.97.97 0 0 0 .702.284q.42 0 .712-.284a.92.92 0 0 0 .293-.69V6.146a.9.9 0 0 0-.293-.685 1 1 0 0 0-.712-.278m-12.702.283a1 1 0 0 1 .712-.283q.41 0 .702.283a.9.9 0 0 1 .293.68v4.063a.93.93 0 0 1-.288.69.97.97 0 0 1-.707.284 1 1 0 0 1-.712-.284.92.92 0 0 1-.293-.69V6.146q0-.396.293-.68"/>
                                </svg>
                            </div>
                            <h3>Андроид</h3>
                            <span id="AndroidValueHolder" class="counter-value">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
    </div>
</body>

<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>

<script>
    const field_ids = ['TotalValueHolder', 'IOSValueHolder', 'DesktopValueHolder', 'AndroidValueHolder'];
    const admin_token = localStorage.getItem('uzkvartir-token') || null;
    let animated= false;
    const AnimateData = ()=>{
        if (!animated)
            $(document).ready(function () {
                $('.counter-value').each(function () {
                    $(this).prop('Counter', 0).animate({
                        Counter: $(this).text()
                    }, {
                        duration: 1499,
                        easing: 'swing',
                        step: function (now) {
                            $(this).text(Math.ceil(now));
                        }
                    });
                });
            });
            animated= true;
    };

    const UpdateData = (id_index, data)=>{
        const path = document.getElementById(field_ids[id_index]);
        path.textContent = data;
    };

    const SetStatisticalConnection = ()=>{
        const wsScheme = window.location.protocol === "https:" ? "wss" : "ws";
        const admin_token = localStorage.getItem('uzkvartir-token') || null;
        const socketUrl = wsScheme + '://' + window.location.host + `/serverdestination/ws/counter/${admin_token}`;
        const socket = new WebSocket(socketUrl);
        socket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            const devices = data.message;
            const ios = devices.ios;
            const desktop = devices.desktop;
            const android = devices.android;
            UpdateData(0, ios + desktop+android);
            UpdateData(1, ios);
            UpdateData(2, desktop);
            UpdateData(3, android);
            setTimeout(() => {
                AnimateData();
            }, 799);
        };
    };
    
    if (admin_token)
        SetStatisticalConnection();
    else
        window.location.href = "../../login/"

</script>

</html>